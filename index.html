<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NecA's Wayhaven Map</title>

<style>
body {
    margin: 0;
    overflow: hidden;
    background: #111;
    font-family: monospace;
}

#container {
    position: absolute;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
}

#map {
    position: absolute;
    top: 0;
    left: 0;
    transform-origin: 0 0;
    user-select: none;
    pointer-events: none;
    image-rendering: pixelated;
}

#chunkCanvas, #uiCanvas {
    position: absolute;
    top: 0;
    left: 0;
}

#mapsButton {
    position: absolute;
    top: 10px;
    right: 10px;
    width: 40px;
    height: 40px;
    background: rgba(0,0,0,0.8);
    color: white;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
}

#mapsPanel {
    position: absolute;
    top: 60px;
    right: 10px;
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 10px;
    border-radius: 6px;
    display: none;
    width: 260px;
    z-index: 10;
}

.sectionTitle {
    font-weight: bold;
    margin-bottom: 6px;
}

.option, .tool, .toggle {
    padding: 6px;
    cursor: pointer;
    border-radius: 4px;
}

.option:hover, .tool:hover, .toggle:hover {
    background: rgba(255,255,255,0.2);
}

.tool.active {
    background: rgba(255,255,255,0.3);
}

#coords {
    position: absolute;
    top: 10px;
    left: 10px;
    color: #fff;
    background: rgba(0,0,0,0.6);
    padding: 6px 10px;
    border-radius: 4px;
    z-index: 10;
}

#colorRow {
    display: flex;
    align-items: center;
    gap: 6px;
}

#colorInput {
    flex: 1;
}

#colorPreview {
    width: 26px;
    height: 26px;
    border: 1px solid white;
}
</style>
</head>
<body>

<div id="container">
    <img id="map" src="terrain.png">
    <canvas id="chunkCanvas"></canvas>
    <canvas id="uiCanvas"></canvas>
</div>

<div id="coords">X: 0 Y: 0</div>

<div id="mapsButton">ðŸ—º</div>

<div id="mapsPanel">
    <div class="sectionTitle">Maps</div>
    <div class="option" data-src="terrain.png">Terrain Only</div>
    <div class="option" data-src="neca.png">NecA's Map</div>
    <div class="option" data-src="neca_label.png">NecA's Map (No Labels)</div>
    <div class="option" data-src="neca_terrain.png">NecA's Terrain</div>
    <div class="option" data-src="jay.png">JayKobious's Map</div>

    <div class="sectionTitle" style="margin-top:10px;">Terrain</div>
    <div class="toggle" id="chunkToggle">Chunks: OFF</div>

    <div class="sectionTitle" style="margin-top:10px;">ðŸ–Œ Paint</div>
    <div class="tool active" id="paintToggle">Paint Mode: OFF</div>

    <div id="colorRow">
        <input id="colorInput" type="text" value="255,0,0" placeholder="R,G,B">
        <div id="colorPreview"></div>
    </div>
</div>

<script>
const map = document.getElementById("map")
const chunkCanvas = document.getElementById("chunkCanvas")
const uiCanvas = document.getElementById("uiCanvas")

const chunkCtx = chunkCanvas.getContext("2d")
const uiCtx = uiCanvas.getContext("2d")

const container = document.getElementById("container")
const coordsDisplay = document.getElementById("coords")
const colorInput = document.getElementById("colorInput")
const colorPreview = document.getElementById("colorPreview")

chunkCtx.imageSmoothingEnabled = false
uiCtx.imageSmoothingEnabled = false

let posX = 0, posY = 0, velX = 0, velY = 0
let scale = 1, targetScale = 1

const accel = 1.4, friction = 0.85, zoomSpeed = 0.0015

let dragging = false, painting = false, lastX = 0, lastY = 0
let mouseX = 0, mouseY = 0

const chunkSize = 16
const paintedChunks = new Map()
let showChunks = false
let paintMode = false

let imageWidth = 8192, imageHeight = 8192, coordMultiplier = 1

function resizeCanvases() {
    chunkCanvas.width = window.innerWidth
    chunkCanvas.height = window.innerHeight
    uiCanvas.width = window.innerWidth
    uiCanvas.height = window.innerHeight
}
window.addEventListener("resize", resizeCanvases)
resizeCanvases()

map.onload = () => {
    imageWidth = map.naturalWidth
    imageHeight = map.naturalHeight
    coordMultiplier = map.src.includes("neca") || map.src.includes("jay") ? 2 : 1
}

function parseColor() {
    let parts = colorInput.value.split(",")
    if(parts.length !== 3) return "rgba(255,0,0,0.7)"
    const r = Math.min(255, Math.max(0, parseInt(parts[0].trim())))
    const g = Math.min(255, Math.max(0, parseInt(parts[1].trim())))
    const b = Math.min(255, Math.max(0, parseInt(parts[2].trim())))
    const color = `rgba(${r},${g},${b},0.7)`
    colorPreview.style.background = color
    return color
}

let currentColor = parseColor()
colorInput.addEventListener("input", () => currentColor = parseColor())

container.addEventListener("mousemove", e => {
    mouseX = e.clientX
    mouseY = e.clientY

    if (dragging && !paintMode) {
        posX += e.clientX - lastX
        posY += e.clientY - lastY
        lastX = e.clientX
        lastY = e.clientY
    }

    if (painting && paintMode && map.src.includes("terrain.png")) {
        paintChunkAt(e.clientX, e.clientY)
    }

    updateCoords(e.clientX, e.clientY)
})

container.addEventListener("mousedown", e => {
    if (paintMode && map.src.includes("terrain.png")) {
        painting = true
        paintChunkAt(e.clientX, e.clientY)
    } else {
        dragging = true
        lastX = e.clientX
        lastY = e.clientY
    }
})

document.addEventListener("mouseup", () => { dragging = false; painting = false })

document.addEventListener("wheel", e => {
    e.preventDefault()
    const rect = container.getBoundingClientRect()
    const mx = mouseX - rect.left
    const my = mouseY - rect.top

    const worldX = (mx - posX) / scale
    const worldY = (my - posY) / scale

    const zoomFactor = 1 - e.deltaY * zoomSpeed
    targetScale *= zoomFactor
    scale += (targetScale - scale) * 0.25

    posX = mx - worldX * scale
    posY = my - worldY * scale
}, { passive: false })

const keys = {}
document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true)
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false)

function updateMovement() {
    if (paintMode) return
    if (keys["w"]) velY += accel
    if (keys["s"]) velY -= accel
    if (keys["a"]) velX += accel
    if (keys["d"]) velX -= accel
    velX *= friction
    velY *= friction
    posX += velX
    posY += velY
}

function screenToWorld(x, y) {
    const rect = container.getBoundingClientRect()
    return {
        x: (x - rect.left - posX) / scale,
        y: (y - rect.top - posY) / scale
    }
}

function paintChunkAt(x, y) {
    const world = screenToWorld(x, y)
    const chunkX = Math.floor(world.x / chunkSize)
    const chunkY = Math.floor(world.y / chunkSize)
    paintedChunks.set(chunkX + "," + chunkY, currentColor)
}

function drawChunks() {
    chunkCtx.clearRect(0, 0, chunkCanvas.width, chunkCanvas.height)
    if (!map.src.includes("terrain.png")) return

    paintedChunks.forEach((paint, key) => {
        const [x, y] = key.split(",").map(Number)
        const screenX = x * chunkSize * scale + posX
        const screenY = y * chunkSize * scale + posY
        chunkCtx.fillStyle = paint
        chunkCtx.fillRect(screenX, screenY, chunkSize * scale, chunkSize * scale)
    })

    if (showChunks && scale > 0.03) {
        const visibleX = Math.ceil(chunkCanvas.width / (chunkSize * scale))
        const visibleY = Math.ceil(chunkCanvas.height / (chunkSize * scale))
        const startX = Math.floor((-posX) / (chunkSize * scale))
        const startY = Math.floor((-posY) / (chunkSize * scale))

        for (let x = startX; x < startX + visibleX + 2; x++) {
            for (let y = startY; y < startY + visibleY + 2; y++) {
                const screenX = x * chunkSize * scale + posX
                const screenY = y * chunkSize * scale + posY
                chunkCtx.strokeStyle = "white"
                chunkCtx.lineWidth = 1
                chunkCtx.strokeRect(
                    Math.floor(screenX) + 0.5,
                    Math.floor(screenY) + 0.5,
                    Math.floor(chunkSize * scale),
                    Math.floor(chunkSize * scale)
                )
            }
        }
    }
}

function drawRedBorder() {
    uiCtx.clearRect(0, 0, uiCanvas.width, uiCanvas.height)
    const left = posX
    const top = posY
    const right = posX + imageWidth * scale
    const bottom = posY + imageHeight * scale

    uiCtx.strokeStyle = "red"
    uiCtx.lineWidth = 2
    uiCtx.strokeRect(left, top, right - left, bottom - top)
    uiCtx.strokeRect(1, 1, uiCanvas.width - 2, uiCanvas.height - 2)
}

function updateCoords(x, y) {
    const world = screenToWorld(x, y)
    const centeredX = Math.floor(world.x - imageWidth / 2)
    const centeredY = Math.floor(world.y - imageHeight / 2)
    coordsDisplay.textContent = 
        `X:${Math.floor(centeredX * coordMultiplier)} Y:${Math.floor(centeredY * coordMultiplier)}`
}

function render() {
    updateMovement()
    map.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`
    drawChunks()
    drawRedBorder()
    requestAnimationFrame(render)
}
render()

const mapsButton = document.getElementById("mapsButton")
const mapsPanel = document.getElementById("mapsPanel")
const chunkToggle = document.getElementById("chunkToggle")
const paintToggle = document.getElementById("paintToggle")

mapsButton.onclick = () => {
    mapsPanel.style.display = mapsPanel.style.display === "none" ? "block" : "none"
}

document.querySelectorAll(".option").forEach(option => {
    option.onclick = () => {
        map.src = option.dataset.src
        paintedChunks.clear()
        mapsPanel.style.display = "none"
    }
})

chunkToggle.onclick = () => {
    showChunks = !showChunks
    chunkToggle.textContent = showChunks ? "Chunks: ON" : "Chunks: OFF"
}

paintToggle.onclick = () => {
    paintMode = !paintMode
    paintToggle.textContent = paintMode ? "Paint Mode: ON" : "Paint Mode: OFF"
}
</script>

</body>
</html>
